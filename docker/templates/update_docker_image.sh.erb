#!/bin/bash
#
# Pulls a docker image.
# Returns 0 if there a change.
# Returns 1 if there is no change.
# Returns 3 if something when wrong.
#
DOCKER_IMAGE=$1

<<<<<<< HEAD
<<<<<<< HEAD
BEFORE=$(docker inspect --format='{{.Config.Image}}' ${DOCKER_IMAGE} 2>/dev/null)
<%= @docker_command -%> pull ${DOCKER_IMAGE}
AFTER=$(docker inspect --format='{{.Config.Image}}' ${DOCKER_IMAGE} 2>/dev/null)
=======
BEFORE=$(docker inspect --format='{{.Id}}' ${DOCKER_IMAGE} 2>/dev/null)
<%= @docker_command -%> pull ${DOCKER_IMAGE}
AFTER=$(docker inspect --format='{{.Id}}' ${DOCKER_IMAGE} 2>/dev/null)
>>>>>>> c887bd06d1850eff2505a6dc00584284155634ad
=======
BEFORE=$(docker inspect --format='{{.Id}}' ${DOCKER_IMAGE} 2>/dev/null)
<%= @docker_command -%> pull ${DOCKER_IMAGE}
AFTER=$(docker inspect --format='{{.Id}}' ${DOCKER_IMAGE} 2>/dev/null)
>>>>>>> 5b05f9928392d20140da52f72c42e34ca7b3c890

if [[ -z $AFTER ]]; then
  echo "Docker image ${DOCKER_IMAGE} failed to pull!"
  exit 3
elif [[ $BEFORE == $AFTER ]]; then
  echo "No updates to ${DOCKER_IMAGE} available. Currently on ${AFTER}."
  exit 1
else
  echo "${DOCKER_IMAGE} updated. Changed from ${BEFORE} to ${AFTER}."
  exit 0
fi
